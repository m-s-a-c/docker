groups:
- name: host
  rules:
  - alert: high_cpu_load
    expr: 100 - (avg by(instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80
    for: 30s
    labels:
      severity: critical
    annotations:
      title: "Server under high load."
      summary: "High CPU load on {{$labels.group}} server."
      description: "*-->* {{ $labels.group }} server is under high load, the avg load 1m is at *{{ $value}}*.\n *-->* Reported by *{{ $labels.group }}* instance of job *{{ $labels.job }}*."

  - alert: high_memory_load
    expr: 100 - ((node_memory_MemAvailable_bytes{} * 100) / node_memory_MemTotal_bytes{}) > 80
    for: 30s    
    labels:
      severity: critical
    annotations:
      title: "Server memory is almost full."
      summary: "High memory load on {{$labels.group}} server."
      description: "*-->* {{ $labels.group }} server memory usage has reached *{{ humanize $value}}*%.\n *-->* Reported by *{{ $labels.group }}* instance of job *{{ $labels.job }}*."

  - alert: high_storage_load
    expr: 100 - ((node_filesystem_avail_bytes{mountpoint="/",fstype!="rootfs"} * 100) / node_filesystem_size_bytes{mountpoint="/",fstype!="rootfs"}) > 90
    for: 30s
    labels:
      severity: critical
    annotations:
      title: "Server storage is almost full."
      summary: "High Storage Load on {{ $labels.group }} server."
      description: "*-->* *{{ $labels.group }}* server storage has reached *{{ humanize $value}}%*.\n *-->* Reported by *{{ $labels.group }}* instance of job *{{ $labels.job }}*."

  - alert: fabulate_client_down
    expr: time() - container_last_seen{name="fabulate-client"} > 30
    for: 30s
    labels:
      severity: warning
    annotations:
      title: "Docker Container Down for {{ $labels.group }}."
      summary: "Fabulate Client Panel is down."
      description: "*-->* Reported by *{{ $labels.group }}* instance of job *{{ $labels.job }}*."

  - alert: fabulate_admin_down
    expr: time() - container_last_seen{name="fabulate-admin"} > 30
    for: 30s
    labels:
      severity: warning
    annotations:
      title: "Docker Container Down for {{ $labels.group }}."
      summary: "Fabulate Admin Panel is down."
      description: "*-->* Reported by *{{ $labels.group }}* instance of job *{{ $labels.job }}*."

  - alert: fabulate_node_down
    expr: time() - container_last_seen{name="fabulate-node"} > 30
    for: 30s
    labels:
      severity: warning
    annotations:
      title: "Docker Container Down for {{ $labels.group }}."
      summary: "Fabulate Node Server is down."
      description: "*-->* Reported by *{{ $labels.group }}* instance of job *{{ $labels.job }}*."
